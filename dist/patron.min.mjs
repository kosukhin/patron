function e(e,t){if(void 0===e)throw new Error("value didnt receive guestAware argument");if(void 0===t)throw new Error("value didnt receive guest argument");return"function"==typeof e?e(t):e.value(t)}function t(e){if(void 0===e)throw new Error("isGuestAware didnt receive mbGuestAware argument");return"function"==typeof e||"function"==typeof e?.value}class r{constructor(e){if(this.guestAware=e,void 0===e)throw new Error("GuestAware constructor didnt receive executor function")}value(t){return e(this.guestAware,t),t}}function i(e,t,r){if(void 0===e)throw new Error("give didnt receive data argument");if(void 0===t)throw new Error("give didnt receive guest argument");"function"==typeof t?t(e,r):t.give(e,r)}function s(e){if(void 0===e)throw new Error("isGuest didnt receive mbGuest argument");return"function"==typeof e||"function"==typeof e?.give}class o{constructor(e){if(this.receiver=e,!e)throw new Error("reseiver function was not passed to Guest constructor")}give(e,t){return this.receiver(e,t),this}}var n=Object.defineProperty,u=(e,t,r)=>((e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class a{constructor(e){if(this.baseGuest=e,u(this,"received",!1),void 0===e)throw new Error("PatronOnce didnt receive baseGuest argument")}introduction(){return"patron"}give(e,t){return this.received||(this.received=!0,i(e,this.baseGuest,t)),this}disposed(e){if(this.received)return!0;const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}class c{constructor(e,t){if(this.sourceGuest=e,this.targetGuest=t,void 0===e)throw new Error("GuestCast didnt receive sourceGuest argument");if(void 0===t)throw new Error("GuestCast didnt receive targetGuest argument")}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(e,t){return i(e,this.targetGuest,{...t,data:{...t?.data??{},castedGuest:t?.data?.castedGuest??this}}),this}disposed(e){const t=this.sourceGuest;return!!t.disposed&&t.disposed(e)}}var h=Object.defineProperty,d=(e,t,r)=>((e,t,r)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const l=new Map,v=e=>{if(void 0===e)throw new Error("removePatronFromPools didnt receive patron argument");l.forEach((t=>{t.delete(e)}))},w=e=>{if(void 0===e)throw new Error("isPatronInPools didnt receive patron argument");let t=!1;return l.forEach((r=>{t||(t=r.has(e))})),t};class g{constructor(e){this.initiator=e,d(this,"patrons"),d(this,"give"),this.patrons=new Set,l.set(this,this.patrons);let t=null;const r=(e,t)=>{this.patrons.forEach((r=>{this.sendValueToGuest(e,r,t)}))};this.give=(e,i)=>{const s=()=>{s===t&&r(e,i)};return t=s,queueMicrotask(s),this}}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e),this}remove(e){return this.patrons.delete(e),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t,{}),this}sendValueToGuest(e,t,r){this.guestDisposed(e,t)||i(e,t,{...r,data:{...r?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}var f=Object.defineProperty,b=(e,t,r)=>((e,t,r)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class p{constructor(e){if(this.sourceDocument=e,b(this,"thePool",new g(this)),void 0===e)throw new Error("Source didnt receive sourceDocument argument")}pool(){return this.thePool}give(e){return this.sourceDocument=e,this.thePool.give(this.sourceDocument),this}value(e){return"function"==typeof e?this.thePool.distribute(this.sourceDocument,new o(e)):this.thePool.distribute(this.sourceDocument,e),this}}var m=Object.defineProperty,G=(e,t,r)=>((e,t,r)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class y{constructor(){G(this,"baseSource",new p(null))}value(e){return this.baseSource.value(new c(e,((t,r)=>{null!==t&&i(t,e,r)}))),this}give(e){return this.baseSource.give(e),this}pool(){return this.baseSource.pool()}}class A{constructor(e){if(this.baseGuest=e,void 0===e)throw new Error("GuestObject didnt receive baseGuest argument")}give(e,t){let r=this.baseGuest;return"function"==typeof r&&(r=new o(r)),r.give(e,t),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}var E=Object.defineProperty,P=(e,t,r)=>((e,t,r)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class S{constructor(e){P(this,"guests",new Set),P(this,"patronPool"),this.patronPool=new g(e)}give(e,t){return this.deliverToGuests(e,t),this.patronPool.give(e,t),this}add(e){return"function"!=typeof e&&e.introduction&&"guest"!==e.introduction()||this.guests.add(e),this.patronPool.add(e),this}remove(e){return this.guests.delete(e),this.patronPool.remove(e),this}distribute(e,t){return this.add(t),this.give(e),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(e,t){this.guests.forEach((r=>{i(e,r,t)})),this.guests.clear()}}var F=Object.defineProperty,D=(e,t,r)=>((e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class k{constructor(e=[]){D(this,"theAll"),D(this,"keysKnown"),D(this,"keysFilled",new Set),D(this,"filledAllPool",new S(this)),this.theAll=new p({}),this.keysKnown=new Set(e)}valueArray(e){const t=new A(e);return this.filledAllPool.add(new c(t,(e=>{t.give(Object.values(e))}))),this.isAllFilled()&&this.theAll.value(new o((e=>{this.filledAllPool.give(Object.values(e))}))),this}value(e){const t=new A(e);return this.isAllFilled()?(this.filledAllPool.add(t),this.theAll.value(new o((e=>{this.filledAllPool.give(e)})))):this.filledAllPool.add(t),this}guestKey(e){return this.keysKnown.add(e),new o((t=>{this.theAll.value(new o((r=>{this.keysFilled.add(e);const i={...r,[e]:t};this.theAll.give(i),this.isAllFilled()&&this.filledAllPool.give(i)})))}))}isAllFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}class O{constructor(e,t){if(this.baseSource=e,this.targetSource=t,void 0===e)throw new Error("GuestAwareSequence didnt receive baseSource argument");if(void 0===t)throw new Error("GuestAwareSequence didnt receive targetSource argument")}value(r){const s=new k,o=new y,n=this.targetSource.get(o);return e(this.baseSource,new c(r,(u=>{let c=0;const h=()=>{void 0!==u[c+1]?(c+=1,d()):s.valueArray(r)};function d(){o.give(null);const r=u[c];t(r)?e(r,new a((t=>{o.give(t),e(n,s.guestKey(c.toString())),h()}))):(o.give(r),e(n,s.guestKey(c.toString())),h())}void 0!==u[c]?d():i([],r)}))),this}}class j{constructor(e,t){if(this.baseSource=e,this.targetSource=t,void 0===e)throw new Error("GuestAwareMap didnt receive baseSource argument");if(void 0===t)throw new Error("GuestAwareMap didnt receive targetSource argument")}value(s){const o=new k;return e(this.baseSource,new c(s,(s=>{s.forEach(((s,n)=>{const u=t(s)?s:new r((e=>{i(s,e)}));e(this.targetSource.get(u),o.guestKey(n.toString()))}))}))),o.valueArray(s),this}}class z{constructor(e){if(this.guestAwares=e,void 0===e)throw new Error("GuestAwareRace didnt receive guestAwares argument")}value(t){let r=null;return this.guestAwares.forEach((s=>{e(s,new c(t,(e=>{r&&r!==s||(i(e,t),r=s)})))})),this}}var K=Object.defineProperty,V=(e,t,r)=>((e,t,r)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class C{constructor(e){if(this.configExecutor=e,V(this,"source",new y),void 0===e)throw new Error("GuestAwareActive constructor didnt receive executor function")}do(e){return this.configExecutor(e,this.source),this}value(e){return this.source.value(e),this}}class x{constructor(e){if(this.theValue=e,void 0===e)throw new Error("GuestSync didnt receive theValue argument")}give(e){return this.theValue=e,this}value(){return this.theValue}}class T{constructor(e,t){if(this.guest=e,this.disposeCheck=t,void 0===e)throw new Error("GuestDisposable didnt receive guest argument");if(void 0===t)throw new Error("GuestDisposable didnt receive disposeCheck argument")}disposed(e){return this.disposeCheck(e)}give(e,t){return i(e,this.guest,t),this}}class B{constructor(e){if(this.willBePatron=e,void 0===e)throw new Error("Patron didnt receive willBePatron argument")}introduction(){return"patron"}give(e,t){return i(e,this.willBePatron,t),this}disposed(e){const t=this.willBePatron;return t?.disposed?.(e)||!1}}class M{constructor(e,t){if(this.baseGuest=e,this.baseGuestAware=t,void 0===e)throw new Error("SourceDynamic didnt receive baseGuest argument");if(void 0===t)throw new Error("SourceDynamic didnt receive baseGuestAware argument")}value(t){return e(this.baseGuestAware,t),this}give(e){return i(e,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}}class q{constructor(e,t={}){if(this.constructorFn=e,this.modules=t,void 0===e)throw new Error("PrivateClass didnt receive constructorFn argument")}get(...e){return new this.constructorFn(...e,this.modules)}}class I{constructor(e){if(this.buildingFn=e,void 0===e)throw new Error("Private didnt receive buildingFn argument")}get(...e){return this.buildingFn(...e)}}export{o as Guest,r as GuestAware,C as GuestAwareActive,k as GuestAwareAll,j as GuestAwareMap,z as GuestAwareRace,O as GuestAwareSequence,c as GuestCast,T as GuestDisposable,A as GuestObject,S as GuestPool,x as GuestSync,B as Patron,a as PatronOnce,g as PatronPool,I as Private,q as PrivateClass,p as Source,M as SourceDynamic,y as SourceEmpty,i as give,s as isGuest,t as isGuestAware,w as isPatronInPools,v as removePatronFromPools,e as value};
//# sourceMappingURL=patron.min.mjs.map
