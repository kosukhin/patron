class t{constructor(t){this.guestReceiver=t}value(t){return this.guestReceiver(t),t}}function e(t,e,i){"function"==typeof e?e(t,i):e.give(t,i)}class i{constructor(t){this.receiver=t}give(t,e){return this.receiver(t,e),this}}class s{constructor(t,e){this.sourceGuest=t,this.targetGuest=e}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(t,i){return e(t,this.targetGuest,i),this}}var r=Object.defineProperty,n=(t,e,i)=>((t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);const o=new Map,u=t=>{o.forEach((e=>{e.delete(t)}))},h=t=>{let e=!1;return o.forEach((i=>{e||(e=i.has(t))})),e};class a{constructor(t){this.initiator=t,n(this,"patrons"),n(this,"give"),this.patrons=new Set,o.set(this,this.patrons);let e=null;const i=(t,e)=>{this.patrons.forEach((i=>{this.sendValueToGuest(t,i,e)}))};this.give=(t,s)=>{const r=()=>{r===e&&i(t,s)};return e=r,queueMicrotask(r),this}}add(t){return"function"!=typeof t&&t.introduction&&"patron"===t.introduction()&&this.patrons.add(t),this}remove(t){return this.patrons.delete(t),this}distribute(t,e){return this.add(e),this.sendValueToGuest(t,e,{}),this}sendValueToGuest(t,i,s){e(t,i,{...s,data:{...s?.data??{},initiator:this.initiator,pool:this}})}}var l=Object.defineProperty,c=(t,e,i)=>((t,e,i)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);class d{constructor(t){c(this,"guests",new Set),c(this,"patronPool"),this.patronPool=new a(t)}give(t,e){return this.deliverToGuests(t,e),this.patronPool.give(t,e),this}add(t){return"function"!=typeof t&&t.introduction&&"guest"!==t.introduction()||this.guests.add(t),this.patronPool.add(t),this}remove(t){return this.guests.delete(t),this.patronPool.remove(t),this}distribute(t,e){return this.add(e),this.give(t),this}deliverToGuests(t,i){this.guests.forEach((s=>{e(t,s,i)})),this.guests.clear()}}class v{constructor(t,e){this.baseGuest=t,this.middleFn=e}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}give(t,e){return this.middleFn(t,e),this}}var b=Object.defineProperty,f=(t,e,i)=>((t,e,i)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,e+"",i);class g{constructor(t){this.sourceDocument=t,f(this,"pool",new a(this))}give(t){return this.sourceDocument=t,this.pool.give(this.sourceDocument),this}value(t){return"function"==typeof t?this.pool.distribute(this.sourceDocument,new i(t)):this.pool.distribute(this.sourceDocument,t),this}}class p{constructor(t){this.baseGuest=t}give(t,e){let s=this.baseGuest;return"function"==typeof s&&(s=new i(s)),s.give(t,e),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}}var w=Object.defineProperty,y=(t,e,i)=>((t,e,i)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);class G{constructor(){y(this,"theChain"),y(this,"keysKnown",new Set),y(this,"keysFilled",new Set),y(this,"filledChainPool",new d(this)),this.theChain=new g({})}resultArray(t){const e=new p(t);return this.filledChainPool.add(new v(e,(t=>Object.values(t)))),this.isChainFilled()&&this.theChain.value(new i((t=>{this.filledChainPool.give(Object.values(t))}))),this}result(t){const e=new p(t);return this.isChainFilled()?(this.filledChainPool.add(e),this.theChain.value(new i((t=>{this.filledChainPool.give(t)})))):this.filledChainPool.add(e),this}receiveKey(t){return this.keysKnown.add(t),new i((e=>{queueMicrotask((()=>{this.theChain.value(new i((i=>{this.keysFilled.add(t);const s={...i,[t]:e};this.theChain.give(s),this.isChainFilled()&&this.filledChainPool.give(s)})))}))}))}isChainFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}class m{constructor(t){this.theValue=t}give(t){return this.theValue=t,this}value(){return this.theValue}}class P{constructor(t){this.willBePatron=t}introduction(){return"patron"}give(t,i){return e(t,this.willBePatron,i),this}}var C=Object.defineProperty,F=(t,e,i)=>((t,e,i)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,e+"",i);class k{constructor(t){this.baseGuest=t,F(this,"received",!1)}introduction(){return"patron"}give(t,i){this.received||e(t,this.baseGuest,i);const s=i?.data;return s?.pool&&s.pool.remove(this),this}}var j=Object.defineProperty,O=(t,e,i)=>((t,e,i)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,e+"",i);class S{constructor(){O(this,"baseSource",new g(null))}value(t){return this.baseSource.value(new v(t,(i=>{null!==i&&e(i,t)}))),this}give(t){return this.baseSource.give(t),this}}class V{constructor(t,e={}){this.constructorFn=t,this.factories=e}create(...t){return new this.constructorFn(...t,this.factories)}}export{V as Factory,i as Guest,t as GuestAware,s as GuestCast,G as GuestChain,v as GuestMiddle,p as GuestObject,d as GuestPool,m as GuestSync,P as Patron,k as PatronOnce,a as PatronPool,g as Source,S as SourceEmpty,e as give,h as isPatronInPools,u as removePatronFromPools};
//# sourceMappingURL=patron.min.mjs.map
