class e{constructor(e){this.guestReceiver=e}value(e){return this.guestReceiver(e),e}}function t(e,t,s){"function"==typeof t?t(e,s):t.give(e,s)}class s{constructor(e){this.receiver=e}give(e,t){return this.receiver(e,t),this}}class i{constructor(e,t){this.sourceGuest=e,this.targetGuest=t}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(e,s){return t(e,this.targetGuest,s),this}disposed(e){const t=this.sourceGuest;return!!t.disposed&&t.disposed(e)}}var r=Object.defineProperty,o=(e,t,s)=>((e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);const n=new Map,u=e=>{n.forEach((t=>{t.delete(e)}))},h=e=>{let t=!1;return n.forEach((s=>{t||(t=s.has(e))})),t};class a{constructor(e){this.initiator=e,o(this,"patrons"),o(this,"give"),this.patrons=new Set,n.set(this,this.patrons);let t=null;const s=(e,t)=>{this.patrons.forEach((s=>{this.sendValueToGuest(e,s,t)}))};this.give=(e,i)=>{const r=()=>{r===t&&s(e,i)};return t=r,queueMicrotask(r),this}}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e),this}remove(e){return this.patrons.delete(e),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t,{}),this}sendValueToGuest(e,s,i){this.guestDisposed(e,s)||t(e,s,{...i,data:{...i?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}var c=Object.defineProperty,l=(e,t,s)=>((e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class d{constructor(e){this.sourceDocument=e,l(this,"thePool",new a(this))}pool(){return this.thePool}give(e){return this.sourceDocument=e,this.thePool.give(this.sourceDocument),this}value(e){return"function"==typeof e?this.thePool.distribute(this.sourceDocument,new s(e)):this.thePool.distribute(this.sourceDocument,e),this}}class v{constructor(e){this.baseGuest=e}give(e,t){let i=this.baseGuest;return"function"==typeof i&&(i=new s(i)),i.give(e,t),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}var g=Object.defineProperty,b=(e,t,s)=>((e,t,s)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class p{constructor(e){b(this,"guests",new Set),b(this,"patronPool"),this.patronPool=new a(e)}give(e,t){return this.deliverToGuests(e,t),this.patronPool.give(e,t),this}add(e){return"function"!=typeof e&&e.introduction&&"guest"!==e.introduction()||this.guests.add(e),this.patronPool.add(e),this}remove(e){return this.guests.delete(e),this.patronPool.remove(e),this}distribute(e,t){return this.add(t),this.give(e),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(e,s){this.guests.forEach((i=>{t(e,i,s)})),this.guests.clear()}}var f=Object.defineProperty,w=(e,t,s)=>((e,t,s)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class y{constructor(){w(this,"theChain"),w(this,"keysKnown",new Set),w(this,"keysFilled",new Set),w(this,"filledChainPool",new p(this)),this.theChain=new d({})}resultArray(e){const t=new v(e);return this.filledChainPool.add(new i(t,(e=>{t.give(Object.values(e))}))),this.isChainFilled()&&this.theChain.value(new s((e=>{this.filledChainPool.give(Object.values(e))}))),this}result(e){const t=new v(e);return this.isChainFilled()?(this.filledChainPool.add(t),this.theChain.value(new s((e=>{this.filledChainPool.give(e)})))):this.filledChainPool.add(t),this}receiveKey(e){return this.keysKnown.add(e),new s((t=>{queueMicrotask((()=>{this.theChain.value(new s((s=>{this.keysFilled.add(e);const i={...s,[e]:t};this.theChain.give(i),this.isChainFilled()&&this.filledChainPool.give(i)})))}))}))}isChainFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}var P=Object.defineProperty,G=(e,t,s)=>((e,t,s)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class m{constructor(){G(this,"baseSource",new d(null))}value(e){return this.baseSource.value(new i(e,(s=>{null!==s&&t(s,e)}))),this}give(e){return this.baseSource.give(e),this}pool(){return this.baseSource.pool()}}class C{constructor(e,t){this.baseSource=e,this.targetSourceFactory=t}value(e){const s=new y,r=new m,o=this.targetSourceFactory.create(r);return this.baseSource.value(new i(e,(i=>{let n=0;const u=()=>{void 0!==i[n+1]?(n+=1,h()):s.resultArray(e)};function h(){r.give(i[n]),o.value(s.receiveKey(""+n)),o.value(u)}void 0!==i[n]?h():t([],e)}))),this}}class S{constructor(e,t){this.baseSource=e,this.targetSourceFactory=t}value(s){const r=new y;return this.baseSource.value(new i(s,(s=>{s.forEach(((s,i)=>{this.targetSourceFactory.create(new e((e=>{t(s,e)}))).value(r.receiveKey(""+i))}))}))),r.resultArray(s),this}}class F{constructor(e){this.guestAwares=e}value(e){let s=null;return this.guestAwares.forEach((r=>{r.value(new i(e,(i=>{s&&s!==r||(t(i,e),s=r)})))})),this}}var k=Object.defineProperty,E=(e,t,s)=>((e,t,s)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class j{constructor(e){this.configExecutor=e,E(this,"source",new m)}do(e){return this.configExecutor(e,this.source),this}value(e){return this.source.value(e),this}}class O{constructor(e){this.theValue=e}give(e){return this.theValue=e,this}value(){return this.theValue}}class z{constructor(e,t){this.guest=e,this.disposeCheck=t}disposed(e){return this.disposeCheck(e)}give(e,s){return t(e,this.guest,s),this}}class D{constructor(e){this.willBePatron=e}introduction(){return"patron"}give(e,s){return t(e,this.willBePatron,s),this}disposed(e){const t=this.willBePatron;return t?.disposed?.(e)||!1}}var A=Object.defineProperty,K=(e,t,s)=>((e,t,s)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class V{constructor(e){this.baseGuest=e,K(this,"received",!1)}introduction(){return"patron"}give(e,s){this.received||t(e,this.baseGuest,s);const i=s?.data;return i?.pool&&i.pool.remove(this),this}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}class T{constructor(e,t){this.baseGuest=e,this.baseGuestAware=t}value(e){return this.baseGuestAware.value(e),this}give(e){return t(e,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}}class x{constructor(e,t={}){this.constructorFn=e,this.factories=t}create(...e){return new this.constructorFn(...e,this.factories)}}class B{constructor(e){this.buildingFn=e}create(...e){return this.buildingFn(...e)}}export{x as Factory,s as Guest,e as GuestAware,j as GuestAwareActive,S as GuestAwareMap,F as GuestAwareRace,C as GuestAwareSequence,i as GuestCast,y as GuestChain,z as GuestDisposable,v as GuestObject,p as GuestPool,O as GuestSync,B as Module,D as Patron,V as PatronOnce,a as PatronPool,d as Source,T as SourceDynamic,m as SourceEmpty,t as give,h as isPatronInPools,u as removePatronFromPools};
//# sourceMappingURL=patron.min.mjs.map
