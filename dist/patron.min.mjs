function t(t,e){return"function"==typeof t?t(e):t.value(e)}class e{constructor(t){this.guestAware=t}value(e){return t(this.guestAware,e),e}}function s(t,e,s){"function"==typeof e?e(t,s):e.give(t,s)}class i{constructor(t){this.receiver=t}give(t,e){return this.receiver(t,e),this}}class r{constructor(t,e){this.sourceGuest=t,this.targetGuest=e}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(t,e){return s(t,this.targetGuest,e),this}disposed(t){const e=this.sourceGuest;return!!e.disposed&&e.disposed(t)}}var o=Object.defineProperty,n=(t,e,s)=>((t,e,s)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);const u=new Map,h=t=>{u.forEach((e=>{e.delete(t)}))},a=t=>{let e=!1;return u.forEach((s=>{e||(e=s.has(t))})),e};class c{constructor(t){this.initiator=t,n(this,"patrons"),n(this,"give"),this.patrons=new Set,u.set(this,this.patrons);let e=null;const s=(t,e)=>{this.patrons.forEach((s=>{this.sendValueToGuest(t,s,e)}))};this.give=(t,i)=>{const r=()=>{r===e&&s(t,i)};return e=r,queueMicrotask(r),this}}size(){return this.patrons.size}add(t){if(!t)throw new Error("PatronPool add method received nothing!");return"function"!=typeof t&&t.introduction&&"patron"===t.introduction()&&this.patrons.add(t),this}remove(t){return this.patrons.delete(t),this}distribute(t,e){return this.add(e),this.sendValueToGuest(t,e,{}),this}sendValueToGuest(t,e,i){this.guestDisposed(t,e)||s(t,e,{...i,data:{...i?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(t,e){return!!e.disposed?.(t)&&(this.remove(e),!0)}}var l=Object.defineProperty,d=(t,e,s)=>((t,e,s)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class v{constructor(t){this.sourceDocument=t,d(this,"thePool",new c(this))}pool(){return this.thePool}give(t){return this.sourceDocument=t,this.thePool.give(this.sourceDocument),this}value(t){return"function"==typeof t?this.thePool.distribute(this.sourceDocument,new i(t)):this.thePool.distribute(this.sourceDocument,t),this}}class g{constructor(t){this.baseGuest=t}give(t,e){let s=this.baseGuest;return"function"==typeof s&&(s=new i(s)),s.give(t,e),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(t){const e=this.baseGuest;return!!e.disposed&&e.disposed(t)}}var p=Object.defineProperty,b=(t,e,s)=>((t,e,s)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);class f{constructor(t){b(this,"guests",new Set),b(this,"patronPool"),this.patronPool=new c(t)}give(t,e){return this.deliverToGuests(t,e),this.patronPool.give(t,e),this}add(t){return"function"!=typeof t&&t.introduction&&"guest"!==t.introduction()||this.guests.add(t),this.patronPool.add(t),this}remove(t){return this.guests.delete(t),this.patronPool.remove(t),this}distribute(t,e){return this.add(e),this.give(t),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(t,e){this.guests.forEach((i=>{s(t,i,e)})),this.guests.clear()}}var w=Object.defineProperty,y=(t,e,s)=>((t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);class P{constructor(){y(this,"theChain"),y(this,"keysKnown",new Set),y(this,"keysFilled",new Set),y(this,"filledChainPool",new f(this)),this.theChain=new v({})}resultArray(t){const e=new g(t);return this.filledChainPool.add(new r(e,(t=>{e.give(Object.values(t))}))),this.isChainFilled()&&this.theChain.value(new i((t=>{this.filledChainPool.give(Object.values(t))}))),this}result(t){const e=new g(t);return this.isChainFilled()?(this.filledChainPool.add(e),this.theChain.value(new i((t=>{this.filledChainPool.give(t)})))):this.filledChainPool.add(e),this}receiveKey(t){return this.keysKnown.add(t),new i((e=>{queueMicrotask((()=>{this.theChain.value(new i((s=>{this.keysFilled.add(t);const i={...s,[t]:e};this.theChain.give(i),this.isChainFilled()&&this.filledChainPool.give(i)})))}))}))}isChainFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}var G=Object.defineProperty,m=(t,e,s)=>((t,e,s)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class C{constructor(){m(this,"baseSource",new v(null))}value(t){return this.baseSource.value(new r(t,(e=>{null!==e&&s(e,t)}))),this}give(t){return this.baseSource.give(t),this}pool(){return this.baseSource.pool()}}class S{constructor(t,e){this.baseSource=t,this.targetSourceFactory=e}value(e){const i=new P,o=new C,n=this.targetSourceFactory.create(o);return t(this.baseSource,new r(e,(r=>{let u=0;const h=()=>{void 0!==r[u+1]?(u+=1,a()):i.resultArray(e)};function a(){o.give(r[u]),t(n,i.receiveKey(""+u)),t(n,h)}void 0!==r[u]?a():s([],e)}))),this}}class F{constructor(t,e){this.baseSource=t,this.targetSourceFactory=e}value(i){const o=new P;return t(this.baseSource,new r(i,(i=>{i.forEach(((i,r)=>{t(this.targetSourceFactory.create(new e((t=>{s(i,t)}))),o.receiveKey(""+r))}))}))),o.resultArray(i),this}}class k{constructor(t){this.guestAwares=t}value(e){let i=null;return this.guestAwares.forEach((o=>{t(o,new r(e,(t=>{i&&i!==o||(s(t,e),i=o)})))})),this}}var E=Object.defineProperty,j=(t,e,s)=>((t,e,s)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class A{constructor(t){this.configExecutor=t,j(this,"source",new C)}do(t){return this.configExecutor(t,this.source),this}value(t){return this.source.value(t),this}}class O{constructor(t){this.theValue=t}give(t){return this.theValue=t,this}value(){return this.theValue}}class z{constructor(t,e){this.guest=t,this.disposeCheck=e}disposed(t){return this.disposeCheck(t)}give(t,e){return s(t,this.guest,e),this}}class D{constructor(t){this.willBePatron=t}introduction(){return"patron"}give(t,e){return s(t,this.willBePatron,e),this}disposed(t){const e=this.willBePatron;return e?.disposed?.(t)||!1}}var K=Object.defineProperty,V=(t,e,s)=>((t,e,s)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class T{constructor(t){this.baseGuest=t,V(this,"received",!1)}introduction(){return"patron"}give(t,e){this.received||s(t,this.baseGuest,e);const i=e?.data;return i?.pool&&i.pool.remove(this),this}disposed(t){const e=this.baseGuest;return!!e.disposed&&e.disposed(t)}}class x{constructor(t,e){this.baseGuest=t,this.baseGuestAware=e}value(e){return t(this.baseGuestAware,e),this}give(t){return s(t,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}}class B{constructor(t,e={}){this.constructorFn=t,this.factories=e}create(...t){return new this.constructorFn(...t,this.factories)}}class M{constructor(t){this.buildingFn=t}create(...t){return this.buildingFn(...t)}}export{B as Factory,i as Guest,e as GuestAware,A as GuestAwareActive,F as GuestAwareMap,k as GuestAwareRace,S as GuestAwareSequence,r as GuestCast,P as GuestChain,z as GuestDisposable,g as GuestObject,f as GuestPool,O as GuestSync,M as Module,D as Patron,T as PatronOnce,c as PatronPool,v as Source,x as SourceDynamic,C as SourceEmpty,s as give,a as isPatronInPools,h as removePatronFromPools,t as value};
//# sourceMappingURL=patron.min.mjs.map
