!function(e){"use strict";function t(e,t){if(void 0===e)throw new Error("value didnt receive guestAware argument");if(void 0===t)throw new Error("value didnt receive guest argument");return"function"==typeof e?e(t):e.value(t)}function r(e){if(void 0===e)throw new Error("isGuestAware didnt receive mbGuestAware argument");return"function"==typeof e||"function"==typeof e?.value}class s{constructor(e){if(this.guestAware=e,void 0===e)throw new Error("GuestAware constructor didnt receive executor function")}value(e){return t(this.guestAware,e),e}}function i(e,t,r){if(void 0===e)throw new Error("give didnt receive data argument");if(void 0===t)throw new Error("give didnt receive guest argument");"function"==typeof t?t(e,r):t.give(e,r)}class o{constructor(e){if(this.receiver=e,!e)throw new Error("reseiver function was not passed to Guest constructor")}give(e,t){return this.receiver(e,t),this}}var n=Object.defineProperty,u=(e,t,r)=>((e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class a{constructor(e){if(this.baseGuest=e,u(this,"received",!1),void 0===e)throw new Error("PatronOnce didnt receive baseGuest argument")}introduction(){return"patron"}give(e,t){return this.received||(this.received=!0,i(e,this.baseGuest,t)),this}disposed(e){if(this.received)return!0;const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}class c{constructor(e,t){if(this.sourceGuest=e,this.targetGuest=t,void 0===e)throw new Error("GuestCast didnt receive sourceGuest argument");if(void 0===t)throw new Error("GuestCast didnt receive targetGuest argument")}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(e,t){return i(e,this.targetGuest,{...t,data:{...t?.data??{},castedGuest:t?.data?.castedGuest??this}}),this}disposed(e){const t=this.sourceGuest;return!!t.disposed&&t.disposed(e)}}var h=Object.defineProperty,l=(e,t,r)=>((e,t,r)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const d=new Map;class v{constructor(e){this.initiator=e,l(this,"patrons"),l(this,"give"),this.patrons=new Set,d.set(this,this.patrons);let t=null;const r=(e,t)=>{this.patrons.forEach((r=>{this.sendValueToGuest(e,r,t)}))};this.give=(e,s)=>{const i=()=>{i===t&&r(e,s)};return t=i,queueMicrotask(i),this}}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e),this}remove(e){return this.patrons.delete(e),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t,{}),this}sendValueToGuest(e,t,r){this.guestDisposed(e,t)||i(e,t,{...r,data:{...r?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}var w=Object.defineProperty,g=(e,t,r)=>((e,t,r)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class f{constructor(e){if(this.sourceDocument=e,g(this,"thePool",new v(this)),void 0===e)throw new Error("Source didnt receive sourceDocument argument")}pool(){return this.thePool}give(e){return this.sourceDocument=e,this.thePool.give(this.sourceDocument),this}value(e){return"function"==typeof e?this.thePool.distribute(this.sourceDocument,new o(e)):this.thePool.distribute(this.sourceDocument,e),this}}var b=Object.defineProperty,p=(e,t,r)=>((e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class G{constructor(){p(this,"baseSource",new f(null))}value(e){return this.baseSource.value(new c(e,((t,r)=>{null!==t&&i(t,e,r)}))),this}give(e){return this.baseSource.give(e),this}pool(){return this.baseSource.pool()}}class m{constructor(e){if(this.baseGuest=e,void 0===e)throw new Error("GuestObject didnt receive baseGuest argument")}give(e,t){let r=this.baseGuest;return"function"==typeof r&&(r=new o(r)),r.give(e,t),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}var P=Object.defineProperty,A=(e,t,r)=>((e,t,r)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class y{constructor(e){A(this,"guests",new Set),A(this,"patronPool"),this.patronPool=new v(e)}give(e,t){return this.deliverToGuests(e,t),this.patronPool.give(e,t),this}add(e){return"function"!=typeof e&&e.introduction&&"guest"!==e.introduction()||this.guests.add(e),this.patronPool.add(e),this}remove(e){return this.guests.delete(e),this.patronPool.remove(e),this}distribute(e,t){return this.add(t),this.give(e),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(e,t){this.guests.forEach((r=>{i(e,r,t)})),this.guests.clear()}}var E=Object.defineProperty,S=(e,t,r)=>((e,t,r)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class F{constructor(e=[]){S(this,"theAll"),S(this,"keysKnown"),S(this,"keysFilled",new Set),S(this,"filledAllPool",new y(this)),this.theAll=new f({}),this.keysKnown=new Set(e)}valueArray(e){const t=new m(e);return this.filledAllPool.add(new c(t,(e=>{t.give(Object.values(e))}))),this.isAllFilled()&&this.theAll.value(new o((e=>{this.filledAllPool.give(Object.values(e))}))),this}value(e){const t=new m(e);return this.isAllFilled()?(this.filledAllPool.add(t),this.theAll.value(new o((e=>{this.filledAllPool.give(e)})))):this.filledAllPool.add(t),this}guestKey(e){return this.keysKnown.add(e),new o((t=>{this.theAll.value(new o((r=>{this.keysFilled.add(e);const s={...r,[e]:t};this.theAll.give(s),this.isAllFilled()&&this.filledAllPool.give(s)})))}))}isAllFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}var D=Object.defineProperty,O=(e,t,r)=>((e,t,r)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);e.Guest=o,e.GuestAware=s,e.GuestAwareActive=class{constructor(e){if(this.configExecutor=e,O(this,"source",new G),void 0===e)throw new Error("GuestAwareActive constructor didnt receive executor function")}do(e){return this.configExecutor(e,this.source),this}value(e){return this.source.value(e),this}},e.GuestAwareAll=F,e.GuestAwareMap=class{constructor(e,t){if(this.baseSource=e,this.targetSource=t,void 0===e)throw new Error("GuestAwareMap didnt receive baseSource argument");if(void 0===t)throw new Error("GuestAwareMap didnt receive targetSource argument")}value(e){const o=new F;return t(this.baseSource,new c(e,(e=>{e.forEach(((e,n)=>{const u=r(e)?e:new s((t=>{i(e,t)}));t(this.targetSource.get(u),o.guestKey(n.toString()))}))}))),o.valueArray(e),this}},e.GuestAwareRace=class{constructor(e){if(this.guestAwares=e,void 0===e)throw new Error("GuestAwareRace didnt receive guestAwares argument")}value(e){let r=null;return this.guestAwares.forEach((s=>{t(s,new c(e,(t=>{r&&r!==s||(i(t,e),r=s)})))})),this}},e.GuestAwareSequence=class{constructor(e,t){if(this.baseSource=e,this.targetSource=t,void 0===e)throw new Error("GuestAwareSequence didnt receive baseSource argument");if(void 0===t)throw new Error("GuestAwareSequence didnt receive targetSource argument")}value(e){const s=new F,o=new G,n=this.targetSource.get(o);return t(this.baseSource,new c(e,(u=>{let c=0;const h=()=>{void 0!==u[c+1]?(c+=1,l()):s.valueArray(e)};function l(){o.give(null);const e=u[c];r(e)?t(e,new a((e=>{o.give(e),t(n,s.guestKey(c.toString())),h()}))):(o.give(e),t(n,s.guestKey(c.toString())),h())}void 0!==u[c]?l():i([],e)}))),this}},e.GuestCast=c,e.GuestDisposable=class{constructor(e,t){if(this.guest=e,this.disposeCheck=t,void 0===e)throw new Error("GuestDisposable didnt receive guest argument");if(void 0===t)throw new Error("GuestDisposable didnt receive disposeCheck argument")}disposed(e){return this.disposeCheck(e)}give(e,t){return i(e,this.guest,t),this}},e.GuestObject=m,e.GuestPool=y,e.GuestSync=class{constructor(e){if(this.theValue=e,void 0===e)throw new Error("GuestSync didnt receive theValue argument")}give(e){return this.theValue=e,this}value(){return this.theValue}},e.Patron=class{constructor(e){if(this.willBePatron=e,void 0===e)throw new Error("Patron didnt receive willBePatron argument")}introduction(){return"patron"}give(e,t){return i(e,this.willBePatron,t),this}disposed(e){const t=this.willBePatron;return t?.disposed?.(e)||!1}},e.PatronOnce=a,e.PatronPool=v,e.Private=class{constructor(e){if(this.buildingFn=e,void 0===e)throw new Error("Private didnt receive buildingFn argument")}get(...e){return this.buildingFn(...e)}},e.PrivateClass=class{constructor(e,t={}){if(this.constructorFn=e,this.modules=t,void 0===e)throw new Error("PrivateClass didnt receive constructorFn argument")}get(...e){return new this.constructorFn(...e,this.modules)}},e.Source=f,e.SourceDynamic=class{constructor(e,t){if(this.baseGuest=e,this.baseGuestAware=t,void 0===e)throw new Error("SourceDynamic didnt receive baseGuest argument");if(void 0===t)throw new Error("SourceDynamic didnt receive baseGuestAware argument")}value(e){return t(this.baseGuestAware,e),this}give(e){return i(e,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}},e.SourceEmpty=G,e.give=i,e.isGuest=function(e){if(void 0===e)throw new Error("isGuest didnt receive mbGuest argument");return"function"==typeof e||"function"==typeof e?.give},e.isGuestAware=r,e.isPatronInPools=e=>{if(void 0===e)throw new Error("isPatronInPools didnt receive patron argument");let t=!1;return d.forEach((r=>{t||(t=r.has(e))})),t},e.removePatronFromPools=e=>{if(void 0===e)throw new Error("removePatronFromPools didnt receive patron argument");d.forEach((t=>{t.delete(e)}))},e.value=t}({});
