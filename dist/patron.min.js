!function(t){"use strict";function e(t,e){return"function"==typeof t?t(e):t.value(e)}function s(t){return"function"==typeof t||"function"==typeof t?.value}class i{constructor(t){this.guestAware=t}value(t){return e(this.guestAware,t),t}}function r(t,e,s){"function"==typeof e?e(t,s):e.give(t,s)}class o{constructor(t){this.receiver=t}give(t,e){return this.receiver(t,e),this}}class n{constructor(t,e){this.sourceGuest=t,this.targetGuest=e}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(t,e){return r(t,this.targetGuest,{...e,data:{...e?.data??{},castedGuest:e?.data?.castedGuest??this}}),this}disposed(t){const e=this.sourceGuest;return!!e.disposed&&e.disposed(t)}}var u=Object.defineProperty,a=(t,e,s)=>((t,e,s)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);const l=new Map;class c{constructor(t){this.initiator=t,a(this,"patrons"),a(this,"give"),this.patrons=new Set,l.set(this,this.patrons);let e=null;const s=(t,e)=>{this.patrons.forEach((s=>{this.sendValueToGuest(t,s,e)}))};this.give=(t,i)=>{const r=()=>{r===e&&s(t,i)};return e=r,queueMicrotask(r),this}}size(){return this.patrons.size}add(t){if(!t)throw new Error("PatronPool add method received nothing!");return"function"!=typeof t&&t.introduction&&"patron"===t.introduction()&&this.patrons.add(t),this}remove(t){return this.patrons.delete(t),this}distribute(t,e){return this.add(e),this.sendValueToGuest(t,e,{}),this}sendValueToGuest(t,e,s){this.guestDisposed(t,e)||r(t,e,{...s,data:{...s?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(t,e){return!!e.disposed?.(t)&&(this.remove(e),!0)}}var h=Object.defineProperty,d=(t,e,s)=>((t,e,s)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class v{constructor(t){this.sourceDocument=t,d(this,"thePool",new c(this))}pool(){return this.thePool}give(t){return this.sourceDocument=t,this.thePool.give(this.sourceDocument),this}value(t){return"function"==typeof t?this.thePool.distribute(this.sourceDocument,new o(t)):this.thePool.distribute(this.sourceDocument,t),this}}class g{constructor(t){this.baseGuest=t}give(t,e){let s=this.baseGuest;return"function"==typeof s&&(s=new o(s)),s.give(t,e),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(t){const e=this.baseGuest;return!!e.disposed&&e.disposed(t)}}var f=Object.defineProperty,p=(t,e,s)=>((t,e,s)=>e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);class b{constructor(t){p(this,"guests",new Set),p(this,"patronPool"),this.patronPool=new c(t)}give(t,e){return this.deliverToGuests(t,e),this.patronPool.give(t,e),this}add(t){return"function"!=typeof t&&t.introduction&&"guest"!==t.introduction()||this.guests.add(t),this.patronPool.add(t),this}remove(t){return this.guests.delete(t),this.patronPool.remove(t),this}distribute(t,e){return this.add(e),this.give(t),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(t,e){this.guests.forEach((s=>{r(t,s,e)})),this.guests.clear()}}var w=Object.defineProperty,y=(t,e,s)=>((t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,"symbol"!=typeof e?e+"":e,s);class G{constructor(){y(this,"theAll"),y(this,"keysKnown",new Set),y(this,"keysFilled",new Set),y(this,"filledAllPool",new b(this)),this.theAll=new v({})}valueArray(t){const e=new g(t);return this.filledAllPool.add(new n(e,(t=>{e.give(Object.values(t))}))),this.isAllFilled()&&this.theAll.value(new o((t=>{this.filledAllPool.give(Object.values(t))}))),this}value(t){const e=new g(t);return this.isAllFilled()?(this.filledAllPool.add(e),this.theAll.value(new o((t=>{this.filledAllPool.give(t)})))):this.filledAllPool.add(e),this}guestKey(t){return this.keysKnown.add(t),new o((e=>{queueMicrotask((()=>{this.theAll.value(new o((s=>{this.keysFilled.add(t);const i={...s,[t]:e};this.theAll.give(i),this.isAllFilled()&&this.filledAllPool.give(i)})))}))}))}isAllFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}var P=Object.defineProperty,A=(t,e,s)=>((t,e,s)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class m{constructor(){A(this,"baseSource",new v(null))}value(t){return this.baseSource.value(new n(t,((e,s)=>{null!==e&&r(e,t,s)}))),this}give(t){return this.baseSource.give(t),this}pool(){return this.baseSource.pool()}}var S=Object.defineProperty,F=(t,e,s)=>((t,e,s)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);class k{constructor(t){this.baseGuest=t,F(this,"received",!1)}introduction(){return"patron"}give(t,e){return this.received||(this.received=!0,r(t,this.baseGuest,e)),this}disposed(t){if(this.received)return!0;const e=this.baseGuest;return!!e.disposed&&e.disposed(t)}}var E=Object.defineProperty,O=(t,e,s)=>((t,e,s)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s)(t,e+"",s);t.Factory=class{constructor(t,e={}){this.constructorFn=t,this.factories=e}create(...t){return new this.constructorFn(...t,this.factories)}},t.Guest=o,t.GuestAware=i,t.GuestAwareActive=class{constructor(t){this.configExecutor=t,O(this,"source",new m)}do(t){return this.configExecutor(t,this.source),this}value(t){return this.source.value(t),this}},t.GuestAwareAll=G,t.GuestAwareMap=class{constructor(t,e){this.baseSource=t,this.targetSourceFactory=e}value(t){const o=new G;return e(this.baseSource,new n(t,(t=>{t.forEach(((t,n)=>{const u=s(t)?t:new i((e=>{r(t,e)}));e(this.targetSourceFactory.create(u),o.guestKey(n.toString()))}))}))),o.valueArray(t),this}},t.GuestAwareRace=class{constructor(t){this.guestAwares=t}value(t){let s=null;return this.guestAwares.forEach((i=>{e(i,new n(t,(e=>{s&&s!==i||(r(e,t),s=i)})))})),this}},t.GuestAwareSequence=class{constructor(t,e){this.baseSource=t,this.targetSourceFactory=e}value(t){const i=new G,o=new m,u=this.targetSourceFactory.create(o);return e(this.baseSource,new n(t,(n=>{let a=0;const l=()=>{void 0!==n[a+1]?(a+=1,c()):i.valueArray(t)};function c(){o.give(null);const t=n[a];s(t)?e(t,new k((t=>{o.give(t),e(u,i.guestKey(a.toString())),l()}))):(o.give(t),e(u,i.guestKey(a.toString())),l())}void 0!==n[a]?c():r([],t)}))),this}},t.GuestCast=n,t.GuestDisposable=class{constructor(t,e){this.guest=t,this.disposeCheck=e}disposed(t){return this.disposeCheck(t)}give(t,e){return r(t,this.guest,e),this}},t.GuestObject=g,t.GuestPool=b,t.GuestSync=class{constructor(t){this.theValue=t}give(t){return this.theValue=t,this}value(){return this.theValue}},t.Module=class{constructor(t){this.buildingFn=t}create(...t){return this.buildingFn(...t)}},t.Patron=class{constructor(t){this.willBePatron=t}introduction(){return"patron"}give(t,e){return r(t,this.willBePatron,e),this}disposed(t){const e=this.willBePatron;return e?.disposed?.(t)||!1}},t.PatronOnce=k,t.PatronPool=c,t.Source=v,t.SourceDynamic=class{constructor(t,e){this.baseGuest=t,this.baseGuestAware=e}value(t){return e(this.baseGuestAware,t),this}give(t){return r(t,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}},t.SourceEmpty=m,t.give=r,t.isGuest=function(t){return"function"==typeof t||"function"==typeof t?.give},t.isGuestAware=s,t.isPatronInPools=t=>{let e=!1;return l.forEach((s=>{e||(e=s.has(t))})),e},t.removePatronFromPools=t=>{l.forEach((e=>{e.delete(t)}))},t.value=e}({});
