!function(e){"use strict";function t(e,t){return"function"==typeof e?e(t):e.value(t)}class s{constructor(e){this.guestAware=e}value(e){return t(this.guestAware,e),e}}function i(e,t,s){"function"==typeof t?t(e,s):t.give(e,s)}class r{constructor(e){this.receiver=e}give(e,t){return this.receiver(e,t),this}}class o{constructor(e,t){this.sourceGuest=e,this.targetGuest=t}introduction(){return"function"==typeof this.sourceGuest?"guest":this.sourceGuest.introduction?this.sourceGuest.introduction():"guest"}give(e,t){return i(e,this.targetGuest,t),this}disposed(e){const t=this.sourceGuest;return!!t.disposed&&t.disposed(e)}}var n=Object.defineProperty,u=(e,t,s)=>((e,t,s)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);const a=new Map;class h{constructor(e){this.initiator=e,u(this,"patrons"),u(this,"give"),this.patrons=new Set,a.set(this,this.patrons);let t=null;const s=(e,t)=>{this.patrons.forEach((s=>{this.sendValueToGuest(e,s,t)}))};this.give=(e,i)=>{const r=()=>{r===t&&s(e,i)};return t=r,queueMicrotask(r),this}}size(){return this.patrons.size}add(e){if(!e)throw new Error("PatronPool add method received nothing!");return"function"!=typeof e&&e.introduction&&"patron"===e.introduction()&&this.patrons.add(e),this}remove(e){return this.patrons.delete(e),this}distribute(e,t){return this.add(t),this.sendValueToGuest(e,t,{}),this}sendValueToGuest(e,t,s){this.guestDisposed(e,t)||i(e,t,{...s,data:{...s?.data??{},initiator:this.initiator,pool:this}})}guestDisposed(e,t){return!!t.disposed?.(e)&&(this.remove(t),!0)}}var c=Object.defineProperty,l=(e,t,s)=>((e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class d{constructor(e){this.sourceDocument=e,l(this,"thePool",new h(this))}pool(){return this.thePool}give(e){return this.sourceDocument=e,this.thePool.give(this.sourceDocument),this}value(e){return"function"==typeof e?this.thePool.distribute(this.sourceDocument,new r(e)):this.thePool.distribute(this.sourceDocument,e),this}}class v{constructor(e){this.baseGuest=e}give(e,t){let s=this.baseGuest;return"function"==typeof s&&(s=new r(s)),s.give(e,t),this}introduction(){return"function"!=typeof this.baseGuest&&this.baseGuest.introduction?this.baseGuest.introduction():"guest"}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}}var p=Object.defineProperty,b=(e,t,s)=>((e,t,s)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class g{constructor(e){b(this,"guests",new Set),b(this,"patronPool"),this.patronPool=new h(e)}give(e,t){return this.deliverToGuests(e,t),this.patronPool.give(e,t),this}add(e){return"function"!=typeof e&&e.introduction&&"guest"!==e.introduction()||this.guests.add(e),this.patronPool.add(e),this}remove(e){return this.guests.delete(e),this.patronPool.remove(e),this}distribute(e,t){return this.add(t),this.give(e),this}size(){return this.patronPool.size()+this.guests.size}deliverToGuests(e,t){this.guests.forEach((s=>{i(e,s,t)})),this.guests.clear()}}var w=Object.defineProperty,f=(e,t,s)=>((e,t,s)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class y{constructor(){f(this,"theChain"),f(this,"keysKnown",new Set),f(this,"keysFilled",new Set),f(this,"filledChainPool",new g(this)),this.theChain=new d({})}resultArray(e){const t=new v(e);return this.filledChainPool.add(new o(t,(e=>{t.give(Object.values(e))}))),this.isChainFilled()&&this.theChain.value(new r((e=>{this.filledChainPool.give(Object.values(e))}))),this}result(e){const t=new v(e);return this.isChainFilled()?(this.filledChainPool.add(t),this.theChain.value(new r((e=>{this.filledChainPool.give(e)})))):this.filledChainPool.add(t),this}receiveKey(e){return this.keysKnown.add(e),new r((t=>{queueMicrotask((()=>{this.theChain.value(new r((s=>{this.keysFilled.add(e);const i={...s,[e]:t};this.theChain.give(i),this.isChainFilled()&&this.filledChainPool.give(i)})))}))}))}isChainFilled(){return this.keysFilled.size>0&&this.keysFilled.size===this.keysKnown.size}}var P=Object.defineProperty,G=(e,t,s)=>((e,t,s)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class m{constructor(){G(this,"baseSource",new d(null))}value(e){return this.baseSource.value(new o(e,(t=>{null!==t&&i(t,e)}))),this}give(e){return this.baseSource.give(e),this}pool(){return this.baseSource.pool()}}var S=Object.defineProperty,C=(e,t,s)=>((e,t,s)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);var F=Object.defineProperty,A=(e,t,s)=>((e,t,s)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);e.Factory=class{constructor(e,t={}){this.constructorFn=e,this.factories=t}create(...e){return new this.constructorFn(...e,this.factories)}},e.Guest=r,e.GuestAware=s,e.GuestAwareActive=class{constructor(e){this.configExecutor=e,C(this,"source",new m)}do(e){return this.configExecutor(e,this.source),this}value(e){return this.source.value(e),this}},e.GuestAwareMap=class{constructor(e,t){this.baseSource=e,this.targetSourceFactory=t}value(e){const r=new y;return t(this.baseSource,new o(e,(e=>{e.forEach(((e,o)=>{t(this.targetSourceFactory.create(new s((t=>{i(e,t)}))),r.receiveKey(""+o))}))}))),r.resultArray(e),this}},e.GuestAwareRace=class{constructor(e){this.guestAwares=e}value(e){let s=null;return this.guestAwares.forEach((r=>{t(r,new o(e,(t=>{s&&s!==r||(i(t,e),s=r)})))})),this}},e.GuestAwareSequence=class{constructor(e,t){this.baseSource=e,this.targetSourceFactory=t}value(e){const s=new y,r=new m,n=this.targetSourceFactory.create(r);return t(this.baseSource,new o(e,(o=>{let u=0;const a=()=>{void 0!==o[u+1]?(u+=1,h()):s.resultArray(e)};function h(){r.give(o[u]),t(n,s.receiveKey(""+u)),t(n,a)}void 0!==o[u]?h():i([],e)}))),this}},e.GuestCast=o,e.GuestChain=y,e.GuestDisposable=class{constructor(e,t){this.guest=e,this.disposeCheck=t}disposed(e){return this.disposeCheck(e)}give(e,t){return i(e,this.guest,t),this}},e.GuestObject=v,e.GuestPool=g,e.GuestSync=class{constructor(e){this.theValue=e}give(e){return this.theValue=e,this}value(){return this.theValue}},e.Module=class{constructor(e){this.buildingFn=e}create(...e){return this.buildingFn(...e)}},e.Patron=class{constructor(e){this.willBePatron=e}introduction(){return"patron"}give(e,t){return i(e,this.willBePatron,t),this}disposed(e){const t=this.willBePatron;return t?.disposed?.(e)||!1}},e.PatronOnce=class{constructor(e){this.baseGuest=e,A(this,"received",!1)}introduction(){return"patron"}give(e,t){this.received||i(e,this.baseGuest,t);const s=t?.data;return s?.pool&&s.pool.remove(this),this}disposed(e){const t=this.baseGuest;return!!t.disposed&&t.disposed(e)}},e.PatronPool=h,e.Source=d,e.SourceDynamic=class{constructor(e,t){this.baseGuest=e,this.baseGuestAware=t}value(e){return t(this.baseGuestAware,e),this}give(e){return i(e,this.baseGuest),this}pool(){throw Error("No pool in SourceDynamic")}},e.SourceEmpty=m,e.give=i,e.isPatronInPools=e=>{let t=!1;return a.forEach((s=>{t||(t=s.has(e))})),t},e.removePatronFromPools=e=>{a.forEach((t=>{t.delete(e)}))},e.value=t}({});
